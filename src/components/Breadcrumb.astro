---
import { getCollection } from 'astro:content';

export interface Props {
	currentPath: string;
	currentFile?: string;
}

const { currentPath, currentFile } = Astro.props;

// Fetch blog posts
const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<nav class="w-full max-w-4xl mb-4" aria-label="Breadcrumb">
	<ol class="flex items-center text-sm text-[#6D6D6D] dark:text-[#A0A0A0] font-mono">
		<li class="flex items-center relative">
			<button
				id="breadcrumb-menu-toggle"
				class="hover:text-[#0369A1] dark:hover:text-[#8BE9FD] transition-colors flex items-center cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#0369A1] dark:focus:ring-[#8BE9FD] rounded px-1"
				aria-label="Toggle site navigation menu"
				aria-expanded="false"
			>
				<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
				</svg>
				<span class={currentPath === '/' ? 'text-[#2D2D2D] dark:text-[#F8F8F2] font-medium' : ''}>~</span>
			</button>

			<!-- Dropdown menu -->
			<div
				id="breadcrumb-menu"
				class="hidden absolute top-full left-0 mt-2 bg-[#F8F8F2] dark:bg-[#282A36] border-2 border-[#D0D0D0] dark:border-[#44475A] rounded-lg shadow-2xl min-w-[280px] z-50 overflow-hidden"
			>
				<div class="p-4 font-mono text-sm">
					<!-- Home -->
					<div>
						<a
							href="/"
							class="flex items-center gap-2 text-[#0369A1] dark:text-[#8BE9FD] hover:text-[#0284C7] dark:hover:text-[#FF79C6] transition-colors py-1 px-2 rounded hover:bg-[#E5E5E5] dark:hover:bg-[#21222C]"
						>
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
							</svg>
							<span>~</span>
						</a>
					</div>

					<!-- Nested items under Home -->
					<div class="ml-6 mt-1 space-y-1 border-l-2 border-[#D0D0D0] dark:border-[#44475A] pl-2">
						<!-- About -->
						<div>
							<a
								href="/about"
								class="flex items-center gap-2 text-[#0369A1] dark:text-[#8BE9FD] hover:text-[#0284C7] dark:hover:text-[#FF79C6] transition-colors py-1 px-2 rounded hover:bg-[#E5E5E5] dark:hover:bg-[#21222C]"
							>
								<svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
									<path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
								</svg>
								<span>about_andy.txt</span>
							</a>
						</div>

						<!-- Blog -->
						<div>
							<a
								href="/blog"
								class="flex items-center gap-2 text-[#0369A1] dark:text-[#8BE9FD] hover:text-[#0284C7] dark:hover:text-[#FF79C6] transition-colors py-1 px-2 rounded hover:bg-[#E5E5E5] dark:hover:bg-[#21222C]"
							>
								<svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
									<path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path>
								</svg>
								<span>blog</span>
							</a>
						</div>

						<!-- Contact -->
						<div>
							<a
								href="/contact"
								class="flex items-center gap-2 text-[#0369A1] dark:text-[#8BE9FD] hover:text-[#0284C7] dark:hover:text-[#FF79C6] transition-colors py-1 px-2 rounded hover:bg-[#E5E5E5] dark:hover:bg-[#21222C]"
							>
								<svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
									<path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
									<path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
								</svg>
								<span>contact_form.sh</span>
							</a>
						</div>
					</div>
				</div>
			</div>
		</li>
		{currentPath !== '/' && (
			<>
				<li class="flex items-center mx-1">/</li>
				{currentPath === '/blog' ? (
					<li class="flex items-center text-[#2D2D2D] dark:text-[#F8F8F2] font-medium">
						<svg class="w-3.5 h-3.5 mr-1" fill="currentColor" viewBox="0 0 20 20">
							<path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path>
						</svg>
						blog
					</li>
				) : currentPath === '/about' ? (
					<li class="flex items-center text-[#2D2D2D] dark:text-[#F8F8F2] font-medium">
						<svg class="w-3.5 h-3.5 mr-1" fill="currentColor" viewBox="0 0 20 20">
							<path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
						</svg>
						about_andy.txt
					</li>
				) : currentPath === '/contact' ? (
					<li class="flex items-center text-[#2D2D2D] dark:text-[#F8F8F2] font-medium">
						<svg class="w-3.5 h-3.5 mr-1" fill="currentColor" viewBox="0 0 20 20">
							<path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
							<path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
						</svg>
						contact_form.sh
					</li>
				) : currentPath.startsWith('/blog/') ? (
					<>
						<li class="flex items-center">
							<a href="/blog" class="hover:text-[#0369A1] dark:hover:text-[#8BE9FD] transition-colors flex items-center">
								<svg class="w-3.5 h-3.5 mr-1" fill="currentColor" viewBox="0 0 20 20">
									<path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path>
								</svg>
								blog
							</a>
						</li>
						<li class="flex items-center mx-1">/</li>
						<li class="flex items-center text-[#2D2D2D] dark:text-[#F8F8F2] font-medium">
							<svg class="w-3.5 h-3.5 mr-1" fill="currentColor" viewBox="0 0 20 20">
								<path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
							</svg>
							{currentFile || 'post.txt'}
						</li>
					</>
				) : null}
			</>
		)}
	</ol>
</nav>

<script>
	// Toggle main menu
	const menuToggle = document.getElementById('breadcrumb-menu-toggle');
	const menu = document.getElementById('breadcrumb-menu');

	if (menuToggle && menu) {
		menuToggle.addEventListener('click', () => {
			const isHidden = menu.classList.contains('hidden');
			menu.classList.toggle('hidden');
			menuToggle.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
		});

		// Close menu when clicking outside
		document.addEventListener('click', (e) => {
			if (!menuToggle.contains(e.target as Node) && !menu.contains(e.target as Node)) {
				menu.classList.add('hidden');
				menuToggle.setAttribute('aria-expanded', 'false');
			}
		});
	}

	// Toggle blog folder
	const blogToggle = document.getElementById('blog-folder-toggle');
	const blogSubmenu = document.getElementById('blog-submenu');
	const blogChevron = document.getElementById('blog-chevron');

	if (blogToggle && blogSubmenu && blogChevron) {
		blogToggle.addEventListener('click', (e) => {
			e.stopPropagation(); // Prevent menu from closing
			const isHidden = blogSubmenu.classList.contains('hidden');
			blogSubmenu.classList.toggle('hidden');
			blogToggle.setAttribute('aria-expanded', isHidden ? 'true' : 'false');

			// Rotate chevron
			if (isHidden) {
				blogChevron.style.transform = 'rotate(90deg)';
			} else {
				blogChevron.style.transform = 'rotate(0deg)';
			}
		});
	}
</script>

<style>
	#blog-chevron {
		transition: transform 200ms ease-in-out;
	}
</style>
