---
import { Sun, Moon } from 'lucide-astro';
---

<button
	id="theme-toggle"
	aria-label="Toggle theme"
	class="p-2 rounded-lg bg-slate-200 hover:bg-slate-400 dark:bg-slate-800 dark:hover:bg-slate-600 transition-colors ml-2"
>
	<Sun class="sun-icon w-5 h-5" />
	<Moon class="moon-icon w-5 h-5" />
</button>

<style is:global>
	html:not(.dark) .sun-icon {
		display: none;
	}
	html.dark .sun-icon {
		display: block;
	}
	html:not(.dark) .moon-icon {
		display: block;
	}
	html.dark .moon-icon {
		display: none;
	}
</style>

<script>
	function initThemeToggle() {
		const button = document.getElementById('theme-toggle');

		button?.addEventListener('click', () => {
			const current = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
			const next = current === 'dark' ? 'light' : 'dark';

			document.documentElement.classList.remove('light', 'dark');
			document.documentElement.classList.add(next);
			localStorage.setItem('theme', next);
		});
	}

	// Initialize on page load
	initThemeToggle();

	// Re-initialize after navigation (for SPAs/view transitions)
	document.addEventListener('astro:page-load', initThemeToggle);
</script>
